{
  "hash": "c11455819b3432338d829b17add37bda",
  "result": {
    "markdown": "---\ntitle: \"Simulate from a Normal-inverse-Wishart distribution\"\nauthor: \"Dominic Magirr\"\ndate: \"2023-08-08\"\ncategories: [R]\n---\n\n\n\n\n\n\n## The problem\n\n \n\n- Given some data which I assume is multivariate Gaussian, I'd like to simulate from the posterior distribution of the model parameters.\n\n \n\n- The conjugate Bayesian analysis is a [Normal-inverse-Wishart distribution](https://en.wikipedia.org/wiki/Normal-inverse-Wishart_distribution).\n\n \n\n- I'd like to do this very quickly based on snippets from wikipedia, rather than thinking much about it.\n\n \n\n## Snippets from wikipedia\n\n \n\nHere is the first snippet...\n\n \n\n> To sample from the joint posterior of $(\\mu, \\Sigma)$, one simply draws samples from $\\Sigma \\mid y \\sim W^{-1}(\\Psi_n, \\nu_n)$, then draw $\\mu \\mid \\Sigma, y \\sim N_p(\\mu_n, \\Sigma / \\lambda_n)$, where\n\n$$\\mu_n = \\frac{\\lambda\\mu_0+n\\bar{y}}{\\lambda + n}$$\n\n$$\\lambda_n = \\lambda + n$$\n\n$$\\nu_n = \\nu + n$$\n\n$$\\Psi_n = \\Psi + S + \\frac{\\lambda n}{\\lambda + n}(\\bar{y}-\\mu_0)(\\bar{y}-\\mu_0)^T$$\n\nwhere\n\n$$S = \\sum_{i=1}^n  (y_i -\\bar{y})(y_i - \\bar{y})^T.$$\n\n \n\n \n\nOk, so this assumes we have used a prior distribution:\n\n \n\n$$\\Sigma \\sim W^{-1}(\\Psi, \\nu)$$\n\n$$\\mu \\mid \\Sigma \\sim N(\\mu_0, \\Sigma/\\lambda)$$\n\nI don't want to think too hard about prior distributions, even though that's dangerous. It isn't the point of this exercise. I want $\\mu_0$, $\\lambda$, $\\nu$ and $\\Psi$ to be small. Let's just say zero for now, even if that's a terrible idea. This way I've reduced the problem to drawing samples from $\\Sigma \\mid y \\sim W^{-1}(S, n)$, then $\\mu \\mid \\Sigma, y \\sim N_p(\\bar{y}, \\Sigma / n)$.\n\n \n\n \n\nThe second snippet [(from a different page)](https://en.wikipedia.org/wiki/Inverse-Wishart_distribution) is...\n\n \n\n> If $X\\sim W(\\Sigma, \\nu)$, then $A = X^{-1}$ has an inverse-Wishart distribution $A \\sim W^{-1}(\\Sigma^{-1}, \\nu).$\n\n \n\nOk, so this is mixing up notation now. Our target in our original notation is $\\Sigma \\mid y \\sim W^{-1}(S, n)$. This snippet says we can achieve that by simulating $X$ from a Wishart distribution $X\\sim W(S^{-1}, n)$, and then taking $\\Sigma = X^{-1}$.\n\n \n\n## Example in R\n\n \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# simulate some 3-dimensional normal data, n = 20\n\nn <- 20\n\nY <- mvtnorm::rmvnorm(n = n,\n\n                      mean = c(180, 190, 200),\n\n                      sigma = matrix(70, 3, 3) + diag(30, 3))\n\n \n\n# calculate Y_bar and S\n\nY_bar <- colMeans(Y)\n\nS <- (t(Y) - Y_bar) %*% t(t(Y) - Y_bar)\n\n \n\n# simulate from inverse-Wishart distribution\n\nX <- rWishart(1, df = n, Sigma = solve(S))\n\nSigma <- solve(X[,,1])\n\nSigma\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          [,1]      [,2]     [,3]\n[1,] 101.98658  78.70226 77.46274\n[2,]  78.70226 104.04191 74.81375\n[3,]  77.46274  74.81375 98.78784\n```\n:::\n\n```{.r .cell-code}\n## simulate from normal distribution\n\nmu <- mvtnorm::rmvnorm(1, mean = Y_bar, sigma = Sigma / n)\n\nmu\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         [,1]     [,2]     [,3]\n[1,] 180.9995 191.0862 201.4866\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}