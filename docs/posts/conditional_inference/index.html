<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dominic Magirr">
<meta name="dcterms.date" content="2023-07-15">

<title>Dominic Magirr - Covariate adjustment in RCTs: should we condition on baseline observations?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Dominic Magirr</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dominicmagirr"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DominicMagirr"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://uk.linkedin.com/in/dominic-magirr-87666b12b"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.co.uk/citations?user=obri2xMAAAAJ&amp;hl=en"><i class="bi bi-google" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/@dominicmagirr5571"><i class="bi bi-youtube" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Covariate adjustment in RCTs: should we condition on baseline observations?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">news</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dominic Magirr </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 15, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="to-condition-or-not-part-1" class="level1">
<h1>To condition or not? (Part 1)</h1>
<p>Consider a randomized controlled trial (RCT) with patients <span class="math inline">\(i=1,..., N\)</span>, randomized to treatment <span class="math inline">\(A_i = 1\)</span> or <span class="math inline">\(A_i=0\)</span> with probability <span class="math inline">\(1/2\)</span>. Suppose there is a continuous outcome <span class="math inline">\(Y_i\)</span>.</p>
<p>Should we perform inference conditional on the observed <span class="math inline">\(A\)</span>? For example, are we more interested in a confidence interval <span class="math inline">\(CI_{A}\)</span> for <span class="math inline">\(\theta\)</span> (a treatment effect, say) such that</p>
<p><span class="math display">\[P(\theta \in CI_A \mid A) = 1 - \alpha ?\]</span></p>
<p>Or would we prefer to not condition on <span class="math inline">\(A\)</span>, and aim for a confidence interval <span class="math inline">\(CI\)</span> such that</p>
<p><span class="math display">\[P(\theta \in CI) = 1 - \alpha \]</span> across multiple realizations of the experiment, each with different <span class="math inline">\(A\)</span>’s.</p>
<p>As a concrete example, for a simple Gaussian model with known variance <span class="math inline">\(\sigma^2\)</span>, suppose <span class="math inline">\(N=500\)</span> but we end up with <span class="math inline">\(N_1= 230\)</span> and <span class="math inline">\(N_0= 270\)</span>. Do we prefer to estimate the variance of the difference-in-means estimator via</p>
<p><span class="math inline">\(\frac{\sigma^2}{230} + \frac{\sigma^2}{270}\)</span></p>
<p>or via</p>
<p><span class="math inline">\(\frac{\sigma^2}{250} + \frac{\sigma^2}{250} ?\)</span></p>
<p>I think it’s fair to say that a majority would prefer the first option, i.e., conditional on <span class="math inline">\(A\)</span>.</p>
</section>
<section id="to-condition-or-not-part-2" class="level1">
<h1>To condition or not? (Part 2)</h1>
<p>Now suppose there is a continuous, prognostic, baseline covariate <span class="math inline">\(X_i\)</span>. Should we perform inference conditional on the observed <span class="math inline">\((A,X)\)</span>? For example, should we seek a confidence interval <span class="math inline">\(CI_{A,X}\)</span> such that</p>
<p><span class="math display">\[P(\theta \in CI_{A,X} \mid A, X) = 1 - \alpha \]</span> rather than a confidence interval <span class="math inline">\(CI_A\)</span> such that</p>
<p><span class="math display">\[P(\theta \in CI_{A} \mid A) = 1 - \alpha ?\]</span></p>
<p>Undoubtedly, this is a harder question. There are at least two variants of it, depending on whether or not <span class="math inline">\(X\)</span> is used in the construction of <span class="math inline">\(CI_A\)</span>.</p>
<p>The first variant, where <span class="math inline">\(X\)</span> is completely ignored in the construction of <span class="math inline">\(CI_A\)</span>, has, I think, been comprehensively dealt with, for example by Stephen Senn in his <a href="https://onlinelibrary.wiley.com/doi/pdf/10.1002/sim.5713?casa_token=PP3JuqTFJd8AAAAA:kmx4NizbwzLw84KmVsuJKTGRbJKACKQ9gLnuzA62H8x8ZKUt8st30XTJVRPGPpCkpPyTRqygnaeI8g">Seven Myths about Randomization</a>. Having read that article, no one could possibly argue it’s ok to completely ignore <span class="math inline">\(X\)</span> in this situation.</p>
<p><em>Of course, if there are multiple prognostic baseline covariates, then it may not be practical to condition on all of them. But this is not the direction I want to go in this blog post. I’d rather stick with the single covariate and try to address the second variant of the question.</em></p>
<p>The second variant of the question, where <span class="math inline">\(X\)</span> is used in the construction of <span class="math inline">\(CI_A\)</span> but we still seek inference conditional on <span class="math inline">\(A\)</span> but not <span class="math inline">\(X\)</span>, is far less important than the first. In fact, the intervals <span class="math inline">\(CI_A\)</span> and <span class="math inline">\(CI_{A,X}\)</span> may even be identical, with only the interpretation different.</p>
<p>Nevertheless, it’s still a question that bugs me. And it does have some, albeit minor, practical consequences.</p>
</section>
<section id="the-argument-for-preferring-ci_a-over-ci_ax" class="level1">
<h1>The argument for preferring <span class="math inline">\(CI_A\)</span> over <span class="math inline">\(CI_{A,X}\)</span></h1>
<p>Suppose I fit an ANCOVA model <span class="math inline">\(Y_i \sim N(\beta_0 + \beta_1 A_i + \beta_2 X_i, \sigma^2).\)</span> In this case, suppose both <span class="math inline">\(CI_A\)</span> and <span class="math inline">\(CI_{A,X}\)</span> are just the standard confidence interval for <span class="math inline">\(\beta_1\)</span>.</p>
<p>When I try to make a statement</p>
<p><span class="math display">\[P(\beta_1 \in CI_{A,X} \mid A, X) = 1 - \alpha \]</span></p>
<p>I am relying on the correctness of the model. This is true whether I interpret <span class="math inline">\(\beta_1\)</span> as a conditional treatment effect that is identical across <span class="math inline">\(X\)</span>, or as the marginal treatment effect <span class="math inline">\(E(Y\mid A = 1) - E(Y\mid A = 0)\)</span>.</p>
<p>On the other hand, when I interpret <span class="math inline">\(\beta_1\)</span> as the marginal treatment effect and make a statement</p>
<p><span class="math display">\[P(\beta_1 \in CI_A \mid A) = 1 - \alpha\]</span> then this does not rely on the correctness of the ANCOVA model, in large samples at least (see e.g., <a href="https://thestatsgeek.com/2019/04/29/ancova-in-rcts-model-based-standard-errors-are-valid-even-under-misspecification/">here</a>).</p>
<p><em>I’m taking for granted here that we’d always agree, at a minimum, to assume that <span class="math inline">\((A_i, X_i, Y_i)\)</span> are i.i.d. random variables with some (possibly unspecified) reasonable joint distribution <span class="math inline">\(f\)</span>. We might try to link <span class="math inline">\(f\)</span> to the real world by imagining we take a random sample of patients from an infinite </em> <strong><em>super population</em></strong> <em>and then randomly assign treatment. But of course we do not really take a random sample. And I’m not exactly sure what a </em> <strong><em>super population</em></strong> <em>is.</em></p>
</section>
<section id="the-argument-for-preferring-ci_ax-over-ci_a" class="level1">
<h1>The argument for preferring <span class="math inline">\(CI_{A,X}\)</span> over <span class="math inline">\(CI_A\)</span></h1>
<p>The preceding argument in favour of <span class="math inline">\(CI_A\)</span> seems fairly straightforward. It didn’t take me long to write down. To speak in favour of <span class="math inline">\(CI_{A,X}\)</span> requires getting more philosophical.</p>
<p><em>This is probably a good point to mention the </em> <a href="https://en.wikipedia.org/wiki/Conditionality_principle#:~:text=The%20conditionality%20principle%20is%20a,actually%20performed%20are%20statistically%20irrelevant."><strong><em>conditionality principle.</em></strong></a> <em>Obviously, the type of question I’m asking here is far from new. It has been discussed extensively by many experts starting decades ago, e.g., <a href="https://www.jstor.org/stable/2958922">here</a>, <a href="https://www.tandfonline.com/doi/pdf/10.1080/01621459.2000.10474344?casa_token=wd8U_QIuh5sAAAAA:aKTCTl3YqZum4GF9Gt5rUT6tI3jbZ4hlBtGRJVcS2dfk1mfTLC5O_oRpjVQMPD-TFH4K7QOhwceq">here</a>, <a href="https://books.google.ch/books?hl=en&amp;lr=&amp;id=7fz8JGLmWbgC&amp;oi=fnd&amp;pg=PA3&amp;dq=berger+wolpert+1988&amp;ots=iWqqYIhz0_&amp;sig=p0cWQsAt--p_3-SHzrUd0J2RmR0&amp;redir_esc=y#v=onepage&amp;q=berger%20wolpert%201988&amp;f=false">here</a> and many more. Even my specific question relative to RCTs has received a lot of attention. <a href="https://www.stat.ubc.ca/~john/papers/LiuSIM2009.pdf">This</a> is a good example, among many others. I’d highly recommend reading this work rather than anything I’m about to write.</em></p>
<p>In a nutshell, an analyst providing us with a confidence interval <span class="math inline">\(CI_A\)</span> asks us in some sense (which I’ll explain with an example below) to <em>pretend</em> that we haven’t seen <span class="math inline">\(X\)</span>. They (the analyst) have seen it and used it, but we (the consumer) have to pretend we haven’t in order to claim (with a clear conscience) the robustness property described above.</p>
</section>
<section id="example" class="level1">
<h1>Example</h1>
<p>Suppose <span class="math inline">\(N = 600\)</span> and the distribution of <span class="math inline">\(X\)</span> in the super population is <span class="math inline">\(N(0,1)\)</span>. Suppose in our particular RCT the observed (A, X) was as follows…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">302</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x_fixed_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">600</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>a_fixed_1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">600</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">factor</span>(a_fixed_1), x_fixed_1,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"X"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now suppose the outcome model is</p>
<p><span class="math display">\[Y_i \mid X_i \sim N(900 + 0 A_i - \exp(X_i + 4), 60^2)\]</span></p>
<p>So the treatment effect, conditional or marginal, is <span class="math inline">\(0\)</span>.</p>
<p>We can plot <span class="math inline">\(Y\)</span> against <span class="math inline">\(X\)</span> for a single realization…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>y_ex <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">600</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean =</span> <span class="dv">900</span> <span class="sc">-</span> <span class="fu">exp</span>(x_fixed_1 <span class="sc">+</span> <span class="dv">4</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd =</span> <span class="dv">60</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_fixed_1[a_fixed_1 <span class="sc">==</span> <span class="dv">0</span>], y_ex[a_fixed_1 <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"X"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x_fixed_1[a_fixed_1 <span class="sc">==</span> <span class="dv">1</span>], y_ex[a_fixed_1 <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Under this ‘true’ model, we can check the coverage probability of <span class="math inline">\(CI_{A,X}\)</span>…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sim_1_fixed <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dummy =</span> <span class="dv">0</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                        x_fixed,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                        a_fixed){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">600</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">mean =</span> <span class="dv">900</span> <span class="sc">-</span> <span class="fu">exp</span>(x_fixed <span class="sc">+</span> <span class="dv">4</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">sd =</span> <span class="dv">60</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> x_fixed, <span class="at">a =</span> a_fixed)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> a <span class="sc">+</span> x, <span class="at">data =</span> dat)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit)[<span class="st">"a"</span>,]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>ci_list_1 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">1000</span>), sim_1_fixed, </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">x_fixed =</span> x_fixed_1,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">a_fixed =</span> a_fixed_1)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>ci_mat_1 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ci_list_1)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># check coverage</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ci_mat_1[,<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ci_mat_1[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.819</code></pre>
</div>
</div>
<p>Far below a nominal 95%.</p>
<p>Conversely, if instead of conditioning on the observed <span class="math inline">\((A, X)\)</span>, we only condition on the observed <span class="math inline">\(A\)</span>, we can confirm that the coverage of <span class="math inline">\(CI_A\)</span> is as expected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sim_1_random <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dummy =</span> <span class="dv">0</span>, a_fixed){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">600</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">600</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">mean =</span> <span class="dv">900</span> <span class="sc">-</span> <span class="fu">exp</span>(x <span class="sc">+</span> <span class="dv">4</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">sd =</span> <span class="dv">60</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> x, <span class="at">a =</span> a_fixed)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> a <span class="sc">+</span> x, <span class="at">data =</span> dat)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit)[<span class="st">"a"</span>,]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ci_r_list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">1000</span>), sim_1_random, <span class="at">a_fixed =</span> a_fixed_1)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ci_r_mat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ci_r_list)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># check coverage</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ci_r_mat[,<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ci_r_mat[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.954</code></pre>
</div>
</div>
<p>Now, going back to the conditional case, I created <span class="math inline">\((A, X)\)</span> from a random seed of <code>302</code>. If, instead, I create <span class="math inline">\((A,X)\)</span> with a random seed of <code>303</code> and check the conditional coverage probability again, I find that it is more than <span class="math inline">\(95\%\)</span>…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">303</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x_fixed_2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">600</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ci_list_2 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">1000</span>), sim_1_fixed, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">x_fixed =</span> x_fixed_2,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">a_fixed =</span> a_fixed_1)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>ci_mat_2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ci_list_2)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># check coverage</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ci_mat_2[,<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ci_mat_2[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.973</code></pre>
</div>
</div>
<p>So the <span class="math inline">\(95\%\)</span> coverage of <span class="math inline">\(CI_A\)</span> is based on a mixture of experiments with different <span class="math inline">\((A, X)\)</span>. For some <span class="math inline">\((A,X)\)</span>, e.g.&nbsp;when the seed is <code>302</code>, fewer than 95% of experiments will cover <span class="math inline">\(0\)</span>, while for some other <span class="math inline">\((A,X)\)</span>, e.g., when the seed is <code>303</code>, more than 95% of experiments will cover <span class="math inline">\(0\)</span>.</p>
<p>If we can see <span class="math inline">\((A,X)\)</span>, then we know which of these situations we are in.</p>
<p>Often, a betting analogy is used. If I were to use <span class="math inline">\(CI_A\)</span> as a basis to make bets about the true treatment effect, then, in principle at least, someone with access to the data could potentially make easy money from me. Of course, they don’t know the true outcome model. But they could take a look. Maybe they could fit a low-degree spline model, or whatever.</p>
<p>If access to <span class="math inline">\((A,X)\)</span> were restricted then this kind of thing wouldn’t be possible. That’s what I meant above when saying we have to pretend we haven’t seen <span class="math inline">\(X\)</span>.</p>
<section id="my-thoughts-on-this-example" class="level2">
<h2 class="anchored" data-anchor-id="my-thoughts-on-this-example">My thoughts on this example</h2>
<p>For me, neither <span class="math inline">\(CI_A\)</span> nor <span class="math inline">\(CI_{A,X}\)</span> feel satisfactory in this example. I guess this just shows that I like to condition, since there is nothing technically wrong with <span class="math inline">\(CI_A\)</span>.</p>
<p>My takeaway is that we need to use a half-decent model. This may conflict with the need to pre-specify a primary analysis method in an RCT and we need to find a pragmatic way through that conflict. I don’t think <span class="math inline">\(CI_A\)</span> necessarily saves us from this.</p>
</section>
</section>
<section id="practical-consequences" class="level1">
<h1>Practical consequences</h1>
<p>First, while in the ANCOVA example described above, the intervals <span class="math inline">\(CI_A\)</span> and <span class="math inline">\(CI_{A,X}\)</span> would be identical, this is not the case in other situations, for example with binary endpoints. In these situations, one needs to make a deliberate choice about which framework to follow. There has been a lot of very impressive work on this recently, for example <a href="https://arxiv.org/abs/2302.10404">here</a>, but I think we need to discuss it a bit more.</p>
<p>Second, there’s the issue of how much importance to place on the robustness property described above for favouring <span class="math inline">\(CI_A\)</span> over <span class="math inline">\(CI_{A,X}\)</span>. Do we need to be very strict that our primary analysis methods give correct coverage conditional on <span class="math inline">\(A\)</span> but not <span class="math inline">\(X\)</span>, regardless of model correctness? For example, I think this <a href="https://thestatsgeek.com/2023/06/23/is-the-ich-e9-estimand-addendum-compatible-with-model-based-estimands/">excellent presentation</a> by the <a href="https://thestatsgeek.com/about-thestatsgeek-com/">Stats Geek</a> heads a bit in this direction. (Note: another <a href="https://thestatsgeek.com/2018/11/20/comment-on-conditional-estimation-and-inference-to-address-observed-covariate-imbalance-in-randomized-clinical-trials/">great Stats Geek post</a> covers similar ground to what I’m discussing here).</p>
<p>I’d try to push back on that a little bit. On the one hand, I agree it’s nice to have this robustness property. If we used methods that grossly violated this, then that wouldn’t be good. However, for the reasons given in the example above, I don’t find it so appealing that I would use it in a strict way to categorise what is and isn’t acceptable.</p>
<p>As a concrete example, take the Cox model. It doesn’t matter which estimand one chooses (hazard ratio, difference in RMST, difference in milestone survival, etc.), if a Cox model is used then the type of robustness property described above will never hold. The correctness of the inference, whether conditional or marginal, is dependent on the correctness of the Cox model.</p>
<p>Does this disqualify the Cox model? I would argue not. We can still probe the robustness of the model (<a href="https://dominicmagirr.github.io/blog/posts/stratify_or_adjust/">see my previous post</a>) and check for any big problems. Plus, of course, there’s the whole area of model checking once we have the data, although this obviously has its own challenges.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="dominicmagirr/blog" data-repo-id="R_kgDOJTFrIA" data-category="General" data-category-id="DIC_kwDOJTFrIM4CYyNt" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>